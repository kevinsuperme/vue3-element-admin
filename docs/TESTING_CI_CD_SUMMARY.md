# æµ‹è¯•å’ŒCI/CDå®Œæ•´é…ç½®æ€»ç»“

## æ¦‚è¿°

æœ¬æ–‡æ¡£æ€»ç»“äº†Vue3 Element Adminé¡¹ç›®ä¸­å®Œæ•´çš„æµ‹è¯•æ¡†æ¶å’ŒCI/CDæµæ°´çº¿é…ç½®ã€‚

---

## 1. å•å…ƒæµ‹è¯•é…ç½®

### å‰ç«¯æµ‹è¯• (Vitest)

#### é…ç½®æ–‡ä»¶
- [vitest.config.ts](../vitest.config.ts)
- [tests/setup.ts](../tests/setup.ts)

#### æµ‹è¯•è¦†ç›–ç‡ç›®æ ‡
| æŒ‡æ ‡ | ç›®æ ‡ |
|------|------|
| ä»£ç è¡Œ | â‰¥ 80% |
| å‡½æ•° | â‰¥ 80% |
| åˆ†æ”¯ | â‰¥ 80% |
| è¯­å¥ | â‰¥ 80% |

#### è¿è¡Œå‘½ä»¤
```bash
# è¿è¡Œæ‰€æœ‰å•å…ƒæµ‹è¯•
npm run test:unit

# è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
npm run test:unit -- --coverage

# ç›‘è§†æ¨¡å¼
npm run test:unit -- --watch
```

#### å·²å®Œæˆçš„æµ‹è¯•
- âœ… [APIç”¨æˆ·æ¨¡å—æµ‹è¯•](../tests/unit/api/user.test.ts)
- âœ… [BackToTopç»„ä»¶æµ‹è¯•](../tests/unit/components/BackToTop.test.ts)

### åç«¯æµ‹è¯• (Jest)

#### é…ç½®æ–‡ä»¶
- [backend/jest.config.js](../backend/jest.config.js)
- [backend/tests/setup.ts](../backend/tests/setup.ts)

#### æµ‹è¯•è¦†ç›–ç‡ç›®æ ‡
| æŒ‡æ ‡ | ç›®æ ‡ |
|------|------|
| ä»£ç è¡Œ | â‰¥ 80% |
| å‡½æ•° | â‰¥ 80% |
| åˆ†æ”¯ | â‰¥ 80% |
| è¯­å¥ | â‰¥ 80% |

#### è¿è¡Œå‘½ä»¤
```bash
cd backend

# è¿è¡Œæ‰€æœ‰æµ‹è¯•
npm test

# è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
npm test -- --coverage

# ç›‘è§†æ¨¡å¼
npm test -- --watch
```

#### å·²å®Œæˆçš„æµ‹è¯•
- âœ… [è®¤è¯æ§åˆ¶å™¨æµ‹è¯•](../backend/tests/unit/controllers/authController.test.ts)

---

## 2. ä»£ç è¦†ç›–ç‡æŠ¥å‘Š

### è¦†ç›–ç‡æŠ¥å‘Šå·¥å…·

#### è„šæœ¬ä½ç½®
- [scripts/coverage-report.js](../scripts/coverage-report.js)

#### åŠŸèƒ½ç‰¹ç‚¹
- ğŸ”„ åˆå¹¶å‰åç«¯è¦†ç›–ç‡æŠ¥å‘Š
- ğŸ“Š ç”Ÿæˆè¯¦ç»†çš„è¦†ç›–ç‡ç»Ÿè®¡
- âœ… éªŒè¯è¦†ç›–ç‡é˜ˆå€¼
- ğŸ“ ç”ŸæˆHTMLæŠ¥å‘Š

#### ä½¿ç”¨æ–¹æ³•
```bash
# ç”Ÿæˆå®Œæ•´è¦†ç›–ç‡æŠ¥å‘Š
node scripts/coverage-report.js

# ä»…ç”Ÿæˆå‰ç«¯è¦†ç›–ç‡
node scripts/coverage-report.js --frontend-only

# ä»…ç”Ÿæˆåç«¯è¦†ç›–ç‡
node scripts/coverage-report.js --backend-only

# è‡ªå®šä¹‰é˜ˆå€¼
node scripts/coverage-report.js --thresholds=90
```

#### æŠ¥å‘Šè¾“å‡º
- ğŸ“‚ `coverage-reports/frontend/` - å‰ç«¯è¦†ç›–ç‡æŠ¥å‘Š
- ğŸ“‚ `coverage-reports/backend/` - åç«¯è¦†ç›–ç‡æŠ¥å‘Š
- ğŸ“„ HTMLæŠ¥å‘Šè·¯å¾„ï¼š
  - Frontend: `coverage-reports/frontend/lcov-report/index.html`
  - Backend: `coverage-reports/backend/lcov-report/index.html`

---

## 3. CI/CD æµæ°´çº¿

### GitHub Actionså·¥ä½œæµ

#### ä¸»CI/CDæµæ°´çº¿ (.github/workflows/ci.yml)

##### å·¥ä½œæµè§¦å‘æ¡ä»¶
- Pushåˆ°mainæˆ–developåˆ†æ”¯
- Pull Requeståˆ°mainæˆ–developåˆ†æ”¯

##### åŒ…å«çš„ä½œä¸š

**1. å‰ç«¯æ„å»ºå’Œæµ‹è¯• (frontend)**
- âœ… ä»£ç æ£€å‡º
- âœ… Node.jsç¯å¢ƒè®¾ç½®
- âœ… ä¾èµ–å®‰è£…
- âœ… ESLintæ£€æŸ¥
- âœ… TypeScriptç±»å‹æ£€æŸ¥
- âœ… å•å…ƒæµ‹è¯• + è¦†ç›–ç‡
- âœ… æ„å»ºï¼ˆå¼€å‘å’Œç”Ÿäº§ç¯å¢ƒï¼‰
- âœ… ä¸Šä¼ æ„å»ºäº§ç‰©

**2. åç«¯æ„å»ºå’Œæµ‹è¯• (backend)**
- âœ… ä»£ç æ£€å‡º
- âœ… MongoDBæœåŠ¡å¯åŠ¨
- âœ… Node.jsç¯å¢ƒè®¾ç½®
- âœ… ä¾èµ–å®‰è£…
- âœ… ESLintæ£€æŸ¥
- âœ… TypeScriptç¼–è¯‘æ£€æŸ¥
- âœ… å•å…ƒæµ‹è¯• + è¦†ç›–ç‡
- âœ… æ„å»ºåç«¯
- âœ… ä¸Šä¼ æ„å»ºäº§ç‰©

**3. å®‰å…¨æ‰«æ (security-scan)**
- âœ… npm auditæ£€æŸ¥ï¼ˆå‰åç«¯ï¼‰
- âœ… Snykæ¼æ´æ‰«æ
- âœ… ä¾èµ–å®‰å…¨åˆ†æ

**4. ä»£ç è´¨é‡æ£€æŸ¥ (code-quality)**
- âœ… SonarCloudä»£ç åˆ†æ
- âœ… ä»£ç è´¨é‡æŒ‡æ ‡æ£€æŸ¥

**5. E2Eæµ‹è¯• (e2e-test)**
- âœ… æœåŠ¡å¯åŠ¨
- âœ… Playwright E2Eæµ‹è¯•
- âœ… æµ‹è¯•ç»“æœä¸Šä¼ 

**6. éƒ¨ç½²åˆ°Staging (deploy-staging)**
- âœ… æ¡ä»¶ï¼šdevelopåˆ†æ”¯push
- âœ… ç¯å¢ƒï¼šstaging
- âœ… éƒ¨ç½²å‰åç«¯æ„å»ºäº§ç‰©

**7. éƒ¨ç½²åˆ°Production (deploy-production)**
- âœ… æ¡ä»¶ï¼šmainåˆ†æ”¯push + æ‰€æœ‰æµ‹è¯•é€šè¿‡
- âœ… ç¯å¢ƒï¼šproduction
- âœ… éƒ¨ç½²å‰åç«¯æ„å»ºäº§ç‰©
- âœ… å¥åº·æ£€æŸ¥

**8. è¦†ç›–ç‡æŠ¥å‘Š (coverage-report)**
- âœ… ç”Ÿæˆåˆå¹¶è¦†ç›–ç‡æŠ¥å‘Š
- âœ… ä¸Šä¼ è¦†ç›–ç‡äº§ç‰©
- âœ… PRè¯„è®ºè¦†ç›–ç‡ç»Ÿè®¡

#### ä»£ç è´¨é‡å·¥ä½œæµ (.github/workflows/code-quality.yml)

##### å·¥ä½œæµè§¦å‘æ¡ä»¶
- Pushåˆ°mainæˆ–developåˆ†æ”¯
- Pull Requeståˆ°mainæˆ–developåˆ†æ”¯
- æ¯å‘¨ä¸€æ—©ä¸Š8ç‚¹å®šæ—¶è¿è¡Œ

##### åŒ…å«çš„ä½œä¸š

**1. ä»£ç åˆ†æ (code-analysis)**
- ESLintæ£€æŸ¥ï¼ˆç”ŸæˆcheckstyleæŠ¥å‘Šï¼‰
- Prettieræ ¼å¼æ£€æŸ¥
- TODO/FIXMEæ³¨é‡Šæ£€æŸ¥
- ä»£ç å¤æ‚åº¦åˆ†æ

**2. ä¾èµ–å®‰å…¨æ‰«æ (dependency-scan)**
- Snykæ¼æ´æ‰«æ
- npm auditæ£€æŸ¥
- ä¾èµ–æ›´æ–°æ£€æŸ¥

**3. æ€§èƒ½åˆ†æ (performance-analysis)**
- Bundleå¤§å°åˆ†æ
- Lighthouse CIæ€§èƒ½æµ‹è¯•

**4. TypeScriptç±»å‹æ£€æŸ¥ (type-check)**
- å‰åç«¯TypeScriptç¼–è¯‘æ£€æŸ¥

**5. æ–‡æ¡£æ£€æŸ¥ (docs-check)**
- APIæ–‡æ¡£å®Œæ•´æ€§æ£€æŸ¥
- ç»„ä»¶æ–‡æ¡£æ£€æŸ¥
- Markdownæ–‡ä»¶éªŒè¯
- READMEæ–‡ä»¶æ£€æŸ¥

**6. æäº¤ä¿¡æ¯æ£€æŸ¥ (commit-check)**
- CommitlintéªŒè¯

**7. è´¨é‡æŠ¥å‘Šæ±‡æ€» (quality-report)**
- ç”Ÿæˆç»¼åˆè´¨é‡æŠ¥å‘Š
- PRè¯„è®ºè´¨é‡ç»Ÿè®¡

---

## 4. é…ç½®æ–‡ä»¶

### ä»£ç è´¨é‡é…ç½®

#### Commitlint (.commitlintrc.json)
- æäº¤ä¿¡æ¯æ ¼å¼è§„èŒƒ
- æ”¯æŒçš„æäº¤ç±»å‹ï¼šfeat, fix, docs, style, refactor, perf, test, chore, revert, build, ci, hotfix

#### Markdownlint (.markdownlint.json)
- Markdownæ–‡ä»¶æ ¼å¼è§„èŒƒ
- ä»£ç å—é£æ ¼é…ç½®
- è¡¨æ ¼å’Œé“¾æ¥æ ¼å¼

### ESLinté…ç½®

#### å‰ç«¯ (eslint.config.js)
- Vue 3æ’ä»¶
- TypeScriptæ”¯æŒ
- ä»£ç é£æ ¼è§„åˆ™

#### åç«¯ (backend/eslint.config.js)
- Node.jsç¯å¢ƒ
- TypeScriptæ”¯æŒ
- æœåŠ¡å™¨ç«¯è§„åˆ™

---

## 5. æµ‹è¯•ç­–ç•¥

### æµ‹è¯•é‡‘å­—å¡”

```
       /\
      /E2E\          < 10%: ç«¯åˆ°ç«¯æµ‹è¯•
     /------\
    /IntTests\       < 20%: é›†æˆæµ‹è¯•
   /----------\
  /Unit  Tests\      > 70%: å•å…ƒæµ‹è¯•
 /--------------\
```

### å•å…ƒæµ‹è¯• (70%+)
- **å‰ç«¯**:
  - APIå±‚æµ‹è¯•
  - ç»„ä»¶é€»è¾‘æµ‹è¯•
  - å·¥å…·å‡½æ•°æµ‹è¯•
  - Storeæµ‹è¯•

- **åç«¯**:
  - æ§åˆ¶å™¨æµ‹è¯•
  - æœåŠ¡å±‚æµ‹è¯•
  - ä¸­é—´ä»¶æµ‹è¯•
  - å·¥å…·å‡½æ•°æµ‹è¯•

### é›†æˆæµ‹è¯• (20%)
- APIç«¯ç‚¹æµ‹è¯•
- æ•°æ®åº“é›†æˆæµ‹è¯•
- ç¬¬ä¸‰æ–¹æœåŠ¡é›†æˆæµ‹è¯•

### E2Eæµ‹è¯• (10%)
- å…³é”®ä¸šåŠ¡æµç¨‹æµ‹è¯•
- ç”¨æˆ·ç™»å½•æµç¨‹
- æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•

---

## 6. è¦†ç›–ç‡è¦æ±‚

### ä»£ç è¦†ç›–ç‡é˜ˆå€¼

| é¡¹ç›® | ä»£ç è¡Œ | å‡½æ•° | åˆ†æ”¯ | è¯­å¥ |
|------|--------|------|------|------|
| å‰ç«¯ | â‰¥ 80% | â‰¥ 80% | â‰¥ 80% | â‰¥ 80% |
| åç«¯ | â‰¥ 80% | â‰¥ 80% | â‰¥ 80% | â‰¥ 80% |

### å¼ºåˆ¶è¦æ±‚
- âœ… PRåˆå¹¶å‰å¿…é¡»é€šè¿‡æ‰€æœ‰æµ‹è¯•
- âœ… è¦†ç›–ç‡ä¸å¾—ä½äºé˜ˆå€¼
- âœ… æ–°å¢ä»£ç å¿…é¡»åŒ…å«æµ‹è¯•

---

## 7. æœ€ä½³å®è·µ

### ç¼–å†™æµ‹è¯•

#### å•å…ƒæµ‹è¯•
```typescript
describe('åŠŸèƒ½æè¿°', () => {
  beforeEach(() => {
    // æµ‹è¯•å‰ç½®æ¡ä»¶
  });

  it('åº”è¯¥æ­£ç¡®å¤„ç†æ­£å¸¸æƒ…å†µ', () => {
    // æµ‹è¯•é€»è¾‘
  });

  it('åº”è¯¥æ­£ç¡®å¤„ç†é”™è¯¯æƒ…å†µ', () => {
    // é”™è¯¯å¤„ç†æµ‹è¯•
  });

  it('åº”è¯¥æ­£ç¡®å¤„ç†è¾¹ç•Œæ¡ä»¶', () => {
    // è¾¹ç•Œæµ‹è¯•
  });
});
```

#### Mockæ•°æ®
```typescript
const mockData = {
  // ä½¿ç”¨çœŸå®çš„æ•°æ®ç»“æ„
};

jest.mock('@/api/user', () => ({
  login: jest.fn().mockResolvedValue(mockData)
}));
```

### æäº¤ä¿¡æ¯

#### è§„èŒƒæ ¼å¼
```
<type>(<scope>): <subject>

<body>

<footer>
```

#### ç¤ºä¾‹
```
feat(auth): add JWT token refresh mechanism

- Add refresh token endpoint
- Update token expiration handling
- Add refresh token validation

Closes #123
```

### CI/CDæœ€ä½³å®è·µ

1. **å¿«é€Ÿåé¦ˆ**: å…³é”®æµ‹è¯•ä¼˜å…ˆè¿è¡Œ
2. **å¹¶è¡Œæ‰§è¡Œ**: ç‹¬ç«‹ä½œä¸šå¹¶è¡Œè¿è¡Œ
3. **ç¼“å­˜ä¼˜åŒ–**: ä½¿ç”¨ä¾èµ–ç¼“å­˜åŠ é€Ÿæ„å»º
4. **å®‰å…¨ç¬¬ä¸€**: æ•æ„Ÿä¿¡æ¯ä½¿ç”¨Secretsç®¡ç†
5. **ç¯å¢ƒéš”ç¦»**: å¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒç‹¬ç«‹

---

## 8. æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

#### æµ‹è¯•å¤±è´¥
```bash
# æ¸…ç†ç¼“å­˜é‡æ–°è¿è¡Œ
npm run test:unit -- --clearCache

# æ›´æ–°å¿«ç…§
npm run test:unit -- --updateSnapshot
```

#### è¦†ç›–ç‡ä¸è¶³
```bash
# æŸ¥çœ‹è¯¦ç»†è¦†ç›–ç‡æŠ¥å‘Š
npm run test:unit -- --coverage

# æ‰“å¼€HTMLæŠ¥å‘Š
open coverage/lcov-report/index.html
```

#### CI/CDå¤±è´¥
1. æ£€æŸ¥GitHub Actionsæ—¥å¿—
2. æœ¬åœ°å¤ç°CIç¯å¢ƒ
3. æ£€æŸ¥ä¾èµ–ç‰ˆæœ¬
4. éªŒè¯ç¯å¢ƒå˜é‡

---

## 9. æŒç»­æ”¹è¿›è®¡åˆ’

### çŸ­æœŸç›®æ ‡ (1-2å‘¨)
- [ ] æå‡æµ‹è¯•è¦†ç›–ç‡åˆ°90%
- [ ] æ·»åŠ æ›´å¤šé›†æˆæµ‹è¯•
- [ ] å®Œå–„E2Eæµ‹è¯•ç”¨ä¾‹
- [ ] æ·»åŠ æ€§èƒ½å›å½’æµ‹è¯•

### ä¸­æœŸç›®æ ‡ (1-2æœˆ)
- [ ] å®ç°è‡ªåŠ¨åŒ–å›æ»šæœºåˆ¶
- [ ] æ·»åŠ è“ç»¿éƒ¨ç½²
- [ ] å®ç°é‡‘ä¸é›€å‘å¸ƒ
- [ ] å»ºç«‹ç›‘æ§å‘Šè­¦ä½“ç³»

### é•¿æœŸç›®æ ‡ (3-6æœˆ)
- [ ] å®Œå–„å®¹å™¨åŒ–éƒ¨ç½²
- [ ] å®ç°å¤šäº‘éƒ¨ç½²
- [ ] å»ºç«‹å®Œæ•´çš„å¯è§‚æµ‹æ€§ç³»ç»Ÿ
- [ ] å®ç°é›¶åœæœºéƒ¨ç½²

---

## 10. å‚è€ƒèµ„æº

### æ–‡æ¡£
- [Vitestæ–‡æ¡£](https://vitest.dev/)
- [Jestæ–‡æ¡£](https://jestjs.io/)
- [GitHub Actionsæ–‡æ¡£](https://docs.github.com/en/actions)
- [Codecovæ–‡æ¡£](https://docs.codecov.com/)

### å·¥å…·
- **æµ‹è¯•æ¡†æ¶**: Vitest, Jest
- **E2Eæµ‹è¯•**: Playwright
- **ä»£ç è¦†ç›–ç‡**: v8, Istanbul
- **CI/CD**: GitHub Actions
- **ä»£ç è´¨é‡**: SonarCloud, ESLint
- **å®‰å…¨æ‰«æ**: Snyk, npm audit

---

## æ€»ç»“

é€šè¿‡å®Œæ•´çš„æµ‹è¯•æ¡†æ¶å’ŒCI/CDæµæ°´çº¿é…ç½®ï¼ŒVue3 Element Adminé¡¹ç›®ç°åœ¨å…·å¤‡ï¼š

âœ… **å®Œå–„çš„å•å…ƒæµ‹è¯•** - 80%+ è¦†ç›–ç‡ç›®æ ‡
âœ… **è‡ªåŠ¨åŒ–æµ‹è¯•æµç¨‹** - æ¯æ¬¡æäº¤è‡ªåŠ¨è¿è¡Œ
âœ… **ä»£ç è´¨é‡ä¿è¯** - ESLint + TypeScript + SonarCloud
âœ… **å®‰å…¨æ€§ä¿éšœ** - ä¾èµ–æ‰«æ + æ¼æ´æ£€æµ‹
âœ… **è‡ªåŠ¨åŒ–éƒ¨ç½²** - Staging + Productionç¯å¢ƒ
âœ… **æŒç»­ç›‘æ§** - è¦†ç›–ç‡æŠ¥å‘Š + æ€§èƒ½åˆ†æ

é¡¹ç›®ç°åœ¨æ‹¥æœ‰ç”Ÿäº§çº§çš„è´¨é‡ä¿è¯ä½“ç³»ï¼Œå¯ä»¥å®‰å…¨ã€å¿«é€Ÿåœ°è¿­ä»£å’Œéƒ¨ç½²ã€‚

---

**æ–‡æ¡£ç»´æŠ¤è€…**: Kevin Wan
**æœ€åæ›´æ–°**: 2025-10-30
**ç‰ˆæœ¬**: 1.0.0